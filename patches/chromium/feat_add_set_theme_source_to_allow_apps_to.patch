From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Samuel Attard <sattard@slack-corp.com>
Date: Mon, 26 Aug 2019 14:32:41 -0700
Subject: feat: add set_theme_source to allow apps to override chromiums
 internal theme choice

This patch is required as Chromium doesn't currently let folks using
//ui override the theme choice in NativeTheme.  It defaults to
respecting the OS theme choice and some apps don't always want to do
that.  With this patch we can override the theme value that Chromium
uses internally for things like menus and devtools.

We can remove this patch once it has in some shape been upstreamed.

diff --git a/ui/native_theme/native_theme.h b/ui/native_theme/native_theme.h
index 19a92706da599d44348652b8e9c3eeea1f99f356..b771f6d206a258de54b9f6a29531fe0f14d1ec36 100644
--- a/ui/native_theme/native_theme.h
+++ b/ui/native_theme/native_theme.h
@@ -420,6 +420,24 @@ class COMPONENT_EXPORT(NATIVE_THEME) NativeTheme {
       scoped_refptr<ColorProviderKey::ThemeInitializerSupplier> custom_theme,
       bool use_custom_frame = true) const;
 
+  enum ThemeSource {
+    kSystem,
+    kForcedDark,
+    kForcedLight,
+  };
+
+  ThemeSource theme_source() const {
+    return theme_source_;
+  }
+
+ void set_theme_source(ThemeSource theme_source) {
+   bool was_dark = preferred_color_scheme() == PreferredColorScheme::kDark;
+   theme_source_ = theme_source;
+   if ((preferred_color_scheme() == PreferredColorScheme::kDark) != was_dark) {
+     NotifyOnNativeThemeUpdated();
+   }
+ }
+
   // Returns shared instances of the default native theme for native UI or the
   // web, respectively.
   static NativeTheme* GetInstanceForNativeUi();
@@ -591,6 +609,7 @@ class COMPONENT_EXPORT(NATIVE_THEME) NativeTheme {
   PreferredContrast preferred_contrast_ = PreferredContrast::kNoPreference;
   base::TimeDelta caret_blink_interval_;
   bool use_overlay_scrollbars_ = false;
+  ThemeSource theme_source_ = ThemeSource::kSystem;
 
   raw_ptr<NativeTheme> associated_web_instance_ = nullptr;
 
