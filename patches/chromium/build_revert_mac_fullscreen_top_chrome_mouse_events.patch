From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Keeley Hammond <khammond@slack-corp.com>
Date: Tue, 24 Jun 2025 16:49:05 -0400
Subject: build: revert Mac fullscreen top-chrome mouse events

Reverts "mac: fix missing mouse up and down event in fullscreen top-chrome".
This CL caused all interactions to fail when loading a page via loadURL
on Mac. This patch can be removed when upstream is fixed, or when a better
solution is put in place.

This reverts commit 8c004781dde7d42d9a3fed8cafcaa4929943dd69.

diff --git a/components/remote_cocoa/app_shim/bridged_content_view.mm b/components/remote_cocoa/app_shim/bridged_content_view.mm
index 18eaf31d8ecd65ada39746ba7e7194b82cddca36..735e241b1043a04283e209d7ecadd01deb558bbf 100644
--- a/components/remote_cocoa/app_shim/bridged_content_view.mm
+++ b/components/remote_cocoa/app_shim/bridged_content_view.mm
@@ -283,30 +283,21 @@ - (bool)needsUpdateWindows {
   return current == [super inputContext];
 }
 
-// NSWindow calls -[contentView hitTest:] to determine the target NSView for
-// mouse up and down events. The default implementation recursively calls
-// hitTest: on each subview until it finds a non-nil target.
+// If |point| is classified as a draggable background (HTCAPTION), return nil so
+// that it can lead to a window drag or double-click in the title bar. Dragging
+// could be optimized by telling the window server which regions should be
+// instantly draggable without asking (tracked at https://crbug.com/830962).
 - (NSView*)hitTest:(NSPoint)point {
   gfx::Point flippedPoint(point.x, NSHeight(self.superview.bounds) - point.y);
   remote_cocoa::mojom::HitTestResult hitTestResult;
   _bridge->host()->GetHitTestResult(flippedPoint, &hitTestResult);
-
-  // If `point` is classified as a draggable background (HTCAPTION), return nil
-  // so that it can lead to a window drag or double-click in the title bar.
-  // Dragging could be optimized by telling the window server which regions
-  // should be instantly draggable without asking (tracked at
-  // https://crbug.com/830962).
   if (hitTestResult ==
       remote_cocoa::mojom::HitTestResult::kDraggableBackground) {
     return nil;
   }
 
-  // Send event to views::RootView.
-  if (hitTestResult == remote_cocoa::mojom::HitTestResult::kRootView) {
-    // Most commonly this NSView is NSWindow's contentView. However in immersive
-    // fullscreen, the view may be a subview of another AppKit-owned view in the
-    // titlebar.
-    return self;
+  if (hitTestResult == remote_cocoa::mojom::HitTestResult::kContentView) {
+    return self.window.contentView;
   }
 
   return [super hitTest:point];
diff --git a/components/remote_cocoa/common/native_widget_ns_window_host.mojom b/components/remote_cocoa/common/native_widget_ns_window_host.mojom
index 233b9da9c797a35ec54eab0fad2e4c3cb5bcd470..95e2a8edcf97ba96ccece6ba98384350560859c7 100644
--- a/components/remote_cocoa/common/native_widget_ns_window_host.mojom
+++ b/components/remote_cocoa/common/native_widget_ns_window_host.mojom
@@ -42,10 +42,10 @@ struct ValidateUserInterfaceItemResult {
 enum HitTestResult {
   // Hits the draggable background area. The NSWindow handles the dragging.
   kDraggableBackground,
-  // Hits the NSView that hosts views::RootView. The event is sent to this root
-  // NSView, then the toolkit-views handles the event.
-  kRootView,
-  // Hits a subview of the root NSView. The event is sent to the subview.
+  // Hits the content NSView. The event is send to the content NSView, then the
+  // toolkit-views handles the event.
+  kContentView,
+  // Hits a subview of the content NSView. The event is sent to the subview.
   // Usually, this is a RenderWidgetHostViewCocoa which presents a content
   // area.
   kSubView,
diff --git a/ui/views/cocoa/native_widget_mac_ns_window_host.mm b/ui/views/cocoa/native_widget_mac_ns_window_host.mm
index 049cf4f1adcf4f64cd8692f6e6eda7418008e799..a7352f1e31410f49bd9b027ef728530ffda4539f 100644
--- a/ui/views/cocoa/native_widget_mac_ns_window_host.mm
+++ b/ui/views/cocoa/native_widget_mac_ns_window_host.mm
@@ -1267,7 +1267,7 @@ void HandleAccelerator(const ui::Accelerator& accelerator,
     return true;
   }
 
-  *hit_test_result = remote_cocoa::mojom::HitTestResult::kRootView;
+  *hit_test_result = remote_cocoa::mojom::HitTestResult::kContentView;
   return true;
 }
 
