From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Shelley Vohr <shelley.vohr@gmail.com>
Date: Wed, 3 Jul 2024 08:43:17 +0000
Subject: fix: correct usages of v8::ReturnValue<void>::Set[NonEmpty] for new
 API

Refs https://chromium-review.googlesource.com/c/v8/v8/+/5647894

The Nan tests were  returning the property's value that
was intended to be set or defined, but V8 was interpreting
this value as a boolean result indicating whether the operation
succeeded or not which was incorrect.

This should be upstreamed.

diff --git a/test/cpp/indexedinterceptors.cpp b/test/cpp/indexedinterceptors.cpp
index 11f573f15109620c5105f1c212a5555bedd7e246..19b7673ff4c07236b11e1947d805979c21a0876e 100644
--- a/test/cpp/indexedinterceptors.cpp
+++ b/test/cpp/indexedinterceptors.cpp
@@ -91,9 +91,9 @@ NAN_INDEX_SETTER(IndexedInterceptor::PropertySetter) {
         interceptor->buf
       , *Nan::Utf8String(value)
       , sizeof (interceptor->buf));
-    info.GetReturnValue().Set(info.This());
+    info.GetReturnValue().Set(True());
   } else {
-    info.GetReturnValue().Set(info.This());
+    info.GetReturnValue().Set(True());
   }
   return Intercepted::Yes();
 }
diff --git a/test/cpp/namedinterceptors.cpp b/test/cpp/namedinterceptors.cpp
index 4d8bf5c56ad888234e789f638859142ec92c0fd8..9f4b3b2000188fbeb53a5ec53969226916bac9da 100644
--- a/test/cpp/namedinterceptors.cpp
+++ b/test/cpp/namedinterceptors.cpp
@@ -91,9 +91,9 @@ NAN_PROPERTY_SETTER(NamedInterceptor::PropertySetter) {
         interceptor->buf
       , *Nan::Utf8String(value)
       , sizeof (interceptor->buf));
-    info.GetReturnValue().Set(info.This());
+    info.GetReturnValue().Set(True());
   } else {
-    info.GetReturnValue().Set(info.This());
+    info.GetReturnValue().Set(True());
   }
   return Intercepted::Yes();
 }
